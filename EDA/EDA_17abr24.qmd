---
title: "EDA_17-abr-24"
format: pdf
editor: visual
---

# Primera Revisada de Datos

## Previo

### Bibliotecas

```{r}
library(tidyverse)
library(dplyr)
library(lubridate)
library(janitor)
library(ggplot2)
```

### Carga de Datos

```{r}
raw_data <- read.csv("../data/icm-00-23.csv")
glimpse(raw_data)
```

# Revisión general

## Revisamos años

```{r}
unique(raw_data$Año)
```

```{r}
raw_data %>% filter(Año=="1.CIFRA SIN AÑO DE REFERENCIA")
```

Filtramos estos datos

**Igual hay que preguntar que onda con estos datos**

```{r}
raw_data_1 <- raw_data %>% filter(Año!="1.CIFRA SIN AÑO DE REFERENCIA") %>% 
  mutate(Año=as.integer(Año)) %>% 
  arrange(Año)
unique(raw_data_1$Año)
```

## Revisar Estados

```{r}
unique(raw_data_1$Entidad)
```

## Revisar Género

```{r}
unique(raw_data_1$Sexo)
```

### Revisamos viviendas

Separar viviendas a otra tabla

```{r}
raw_viviendas <- raw_data_1 %>% filter(Sexo=="Viviendas particulares habitadas")
raw_data_2 <- raw_data_1 %>% filter(Sexo!="Viviendas particulares habitadas")
glimpse(raw_viviendas)
unique(raw_viviendas$Año)          #  Sólo hay tres años
unique(raw_viviendas$Entidad)      # Todos los estados y a nivel Nacional
unique(raw_viviendas$Sexo)         # Quitar
unique(raw_viviendas$Edad)         # Quitar
unique(raw_viviendas$Tasa)         # Quitar
unique(raw_viviendas$Población)    # Son 6 categorías
```

Revisamos cómo es el cálculo de porcentaje:

```{r}
raw_viviendas %>% select(Año, Entidad, Población, Cantidad, Totales, Porcentaje) %>% 
  mutate(revision = round(Porcentaje - Cantidad/Totales,3)) %>% 
  filter(revision!=0)
```

Revisamos el total de viviendas:

```{r}
raw_viviendas %>% filter(Entidad!="NACIONAL") %>% 
  group_by(Población) %>% 
  summarise(tot = sum(Totales))

raw_viviendas %>% filter(Entidad=="NACIONAL") %>% 
  group_by(Población) %>% 
  summarise(tot = sum(Totales))
```

Revisamos los datos de Internet

```{r}
raw_viviendas %>% filter(Población=="No disponen de Internet")  %>% 
  group_by(Año) %>% 
  summarise(tot = sum(Totales))
```

No hay año 2000 en Internet

Hacemos los cambios mencionados:

```{r}
raw_viviendas_1 <- raw_viviendas %>% select(Año, Entidad, Población, Cantidad, Totales) %>% 
  mutate(Porcentaje = Cantidad/Totales)
glimpse(raw_viviendas_1)
```

# Revisamos Población

```{r}
unique(raw_data_2$Población)
```

# Clasificación

Vamos a ir filtrando por tema

## Educación

```{r}
```

```{r}
raw_educacion <- raw_data_2 %>% filter(Población == "Población que no asiste a la escuela" | 
                      Población == "Población indígena que no asiste a la escuela" | 
                      Población == "Abandono escolar (primaria)" |
                      Población == "Abandono escolar (secundaria)" |
                      Población == "Inasistencia escolar" |
                      Población == "Rezago educativo (hasta 2018)" |   
                      Población == "Abandono escolar (media superior)" |
                      Población == "Población con condición mental que no asiste a la escuela" |
                      Población == "Rezago educativo (no indígena)" |
                      Población == "Rezago educativo (indígena)" |
                      Población == "Rezago educativo" |
                      Población != "Población afrodescendiente que no asiste a la escuela"
                      )

raw_data_3 <- raw_data_2 %>% filter(Población != "Población que no asiste a la escuela" & 
                      Población != "Población indígena que no asiste a la escuela" &
                      Población != "Abandono escolar (primaria)" &
                      Población != "Abandono escolar (secundaria)" &
                      Población != "Inasistencia escolar" &
                      Población != "Rezago educativo (hasta 2018)" &
                      Población != "Abandono escolar (media superior)" &
                      Población != "Población con condición mental que no asiste a la escuela" &
                      Población != "Rezago educativo (no indígena)" &
                      Población != "Rezago educativo (indígena)" &
                      Población != "Rezago educativo" &
                      Población != "Población afrodescendiente que no asiste a la escuela"  
                      )
```

```{r}
```

## Salud

**Acá también entra seguridad social??**

```{r}
raw_salud <- raw_data_3 %>% filter(Población == "Población sin afiliación a servicio de salud" | 
                      Población == "Población indígena sin afiliación a servicio de salud" | 
                      Población == "Carencia por acceso a servicios de salud (hasta 2018)" |
                      Población == "Población con condición mental sin afiliación a servicio de salud" |
                      Población == "Carencia por acceso a servicios de salud (no indígena)" |
                      Población == "Carencia por acceso a servicios de salud (indígena)" |   
                      Población == "Carencia por acceso a servicios de salud" |
                      Población == "Población afrodescendiente sin afiliación a servicio de salud" |
                      Población == "Carencia por acceso a la seguridad social (no indígena)" |
                      Población == "Carencia por acceso a la seguridad social (indígena)" |
                      Población == "Carencia por acceso a la seguridad social"
                      )

raw_data_4 <- raw_data_3 %>% filter(Población != "Población sin afiliación a servicio de salud" &
                      Población != "Población indígena sin afiliación a servicio de salud" &
                      Población != "Carencia por acceso a servicios de salud (hasta 2018)" &
                      Población != "Población con condición mental sin afiliación a servicio de salud" &
                      Población != "Carencia por acceso a servicios de salud (no indígena)" &
                      Población != "Carencia por acceso a servicios de salud (indígena)" &
                      Población != "Carencia por acceso a servicios de salud" &
                      Población != "Población afrodescendiente sin afiliación a servicio de salud" &
                      Población != "Carencia por acceso a la seguridad social (no indígena)" &
                      Población != "Carencia por acceso a la seguridad social (indígena)" &
                      Población != "Carencia por acceso a la seguridad social"
                      )
```

## Vivienda

```{r}
raw_vivienda_2 <- raw_data_4 %>% filter(Población == "Carencia por calidad y espacios de la vivienda (hasta 2018)" | 
                      Población == "Carencia por servicios básicos de la vivienda (hasta 2018)" | 
                      Población == "Carencia por calidad y espacios de la vivienda (no indígena)" |
                      Población == "Carencia por calidad y espacios de la vivienda (indígena)" |
                      Población == "Carencia por servicios básicos de la vivienda (no indígena)" |
                      Población == "Carencia por servicios básicos de la vivienda (indígena)" |   
                      Población == "Carencia por calidad y espacios de la vivienda" |
                      Población == "Carencia por servicios básicos de la vivienda"
                      )

raw_data_5 <- raw_data_4 %>% filter(Población != "Carencia por calidad y espacios de la vivienda (hasta 2018)" &
                      Población != "Carencia por servicios básicos de la vivienda (hasta 2018)" &
                      Población != "Carencia por calidad y espacios de la vivienda (no indígena)" &
                      Población != "Carencia por calidad y espacios de la vivienda (indígena)" &
                      Población != "Carencia por servicios básicos de la vivienda (no indígena)" &
                      Población != "Carencia por servicios básicos de la vivienda (indígena)" &
                      Población != "Carencia por calidad y espacios de la vivienda" &
                      Población != "Carencia por servicios básicos de la vivienda"
                      )
```

## Alimentación

```{r}
raw_alimentacion <- raw_data_5 %>% filter(Población == "Carencia por acceso a la alimentación (hasta 2018)" | 
                      Población == "Inseguridad alimentaria" | 
                      Población == "Carencia por acceso a la alimentación nutritiva y de calidad (no indígena)" |
                      Población == "Carencia por acceso a la alimentación nutritiva y de calidad (indígena)" |
                      Población == "Carencia por acceso a la alimentación nutritiva y de calidad" 
                      )

raw_data_6 <- raw_data_5 %>% filter(Población != "Carencia por acceso a la alimentación (hasta 2018)" &
                      Población != "Inseguridad alimentaria" &
                      Población != "Carencia por acceso a la alimentación nutritiva y de calidad (no indígena)" &
                      Población != "Carencia por acceso a la alimentación nutritiva y de calidad (indígena)" &
                      Población != "Carencia por acceso a la alimentación nutritiva y de calidad" 
                      )

```

## Pobreza

```{r}
raw_pobreza <- raw_data_6 %>% filter(Población == "Población en pobreza (hasta 2018)" | 
                      Población == "Población en pobreza extrema (hasta 2018)" | 
                      Población == "Población no indígena en pobreza" |
                      Población == "Población indígena en pobreza" |
                      Población == "Población no indígena en pobreza extrema" |
                      Población == "Población indígena en pobreza extrema" |
                      Población == "Población en pobreza" |
                      Población == "Población en pobreza extrema" 
                      )

raw_data_7 <- raw_data_6 %>% filter(Población != "Población en pobreza (hasta 2018)" &
                      Población != "Población en pobreza extrema (hasta 2018)" &
                      Población != "Población no indígena en pobreza" &
                      Población != "Población indígena en pobreza" &
                      Población != "Población no indígena en pobreza extrema" &
                      Población != "Población indígena en pobreza extrema" &
                      Población != "Población en pobreza" &
                      Población != "Población en pobreza extrema" 
                      )
```

## Violencia

**Es correcto poner suicidio aquí??** **Desaparecidos y no localizados???**

```{r}
raw_violencia <- raw_data_7 %>% filter(Población == "Defunciones por agresiones" | 
                      Población == "Tasa de mortalidad infantil" | 
                      Población == "Víctimas de feminicidio" |
                      Población == "Defunciones por suicidio" |
                      Población == "Personas desaparecidas y no localizadas"
                      )

raw_data_8 <- raw_data_7 %>% filter(Población != "Defunciones por agresiones" &
                      Población != "Tasa de mortalidad infantil" &
                      Población != "Víctimas de feminicidio" &
                      Población != "Defunciones por suicidio" &
                      Población != "Personas desaparecidas y no localizadas"
                      )
```

## Madres adolescentes o Matrimonio Infantil

```{r}
raw_m_infantil <- raw_data_8 %>% filter(Población == "Población casada o en unión libre" | 
                      Población == "Nacimientos de madres" | 
                      Población == "Población indígena casada o en unión libre" |
                      Población == "Población con condición mental casada o en unión libre" |
                      Población == "Población afrodescendiente casada o en unión libre" |
                      Población == "Población con hijos" |
                      Población == "Población indígena con hijos" |
                      Población == "Población con condición mental con hijos" |
                      Población == "Población afrodescendiente con hijos"
                      )

raw_data_9 <- raw_data_8 %>% filter(Población != "Población casada o en unión libre" &
                      Población != "Nacimientos de madres" &
                      Población != "Población indígena casada o en unión libre" &
                      Población != "Población con condición mental casada o en unión libre" &
                      Población != "Población afrodescendiente casada o en unión libre" &
                      Población != "Población con hijos" &
                      Población != "Población indígena con hijos" &
                      Población != "Población con condición mental con hijos" &
                      Población != "Población afrodescendiente con hijos"
                      )
```

## Trabajo Infantil

```{r}
raw_trabajo <- raw_data_9 %>% filter(Población == "Población ocupada" | 
                      Población == "Trabajo infantil" 
                      )
raw_data_10 <- raw_data_9 %>% filter(Población != "Población ocupada" &
                      Población != "Trabajo infantil" 
                      )
```

## Derecho a Nacionalidad

```{r}
raw_nacionalidad <- raw_data_10 %>% filter(Población == "Repatriaciones desde EUA" | 
                      Población == "Población con registro" 
                      )
raw_data_11 <- raw_data_10 %>% filter(Población != "Repatriaciones desde EUA" &
                      Población != "Población con registro" 
                      )
```

## Interseccionalidad

```{r}
unique(raw_data_11$Población)
```

**Qué es "Índice de calidad de leyes" ???** **Como afecta "Población que nació fuera de la entidad"???**

# Revisión de cifras

## raw_viviendas_1

```{r}
unique(raw_viviendas_1$Población)

ggplot(raw_viviendas_1, aes(x=Año, y = Porcentaje, colour = Entidad))  + 
  geom_line() +
  facet_wrap(~Población)
                     
```

**Porqué bajan??**

```{r}
unique(raw_viviendas_1$Población)

raw_viviendas_1 %>%
  filter(Entidad != "NACIONAL") %>% 
  ggplot(aes(x=Año, y = Cantidad, colour = Entidad))  + 
  geom_line() +
  facet_wrap(~Población)
```

## raw_vivienda_2

```{r}
glimpse(raw_vivienda_2)
unique(raw_vivienda_2$Año)            # Del 2008-2022 de dos en dos
unique(raw_vivienda_2$Entidad)        # Completo con Nacional
unique(raw_vivienda_2$Edad)           # Intervalos de 3-17 y 0-17 años usarlos para comprobar cantidades
#unique(raw_vivienda_2$Cantidad)       # Algunos NA, investigar donde no hay de: cantidad, totales y porcentaje
```

Vamos a ver dónde están los NA

```{r}
raw_vivienda_2 %>% filter(is.na(Cantidad)) %>% {unique(.$Población)}
```

**Estas cantidades son la suma hasta 2018?**

Limpiamos la parte que no es hasta 2018:

```{r}
raw_vivienda_3 <- raw_vivienda_2 %>% filter(Población!="Carencia por calidad y espacios de la vivienda (hasta 2018)" &
                          Población!="Carencia por servicios básicos de la vivienda (hasta 2018)") 
glimpse(raw_vivienda_3)
unique(raw_vivienda_3$Totales)  # Borrar
unique(raw_vivienda_3$Tasa)     # Borrar 
unique(raw_vivienda_3$Edad)     #Ojo solo de 3-17 y 0-17
unique(raw_vivienda_3$Sexo)     # Hombre Mujer y Total
unique(raw_vivienda_3$Entidad)  # Todos los estados y Nacional
unique(raw_vivienda_3$Año)      # 2016, 2018, 2020, 2022

raw_vivienda_4 <- raw_vivienda_3 %>% select(Año, Entidad, Población, Sexo, Edad, Cantidad, Porcentaje)
```

limpiamos la parte hasta 2018

```{r}
raw_vivienda_5 <- raw_vivienda_2 %>% filter(Población=="Carencia por calidad y espacios de la vivienda (hasta 2018)" |
                          Población=="Carencia por servicios básicos de la vivienda (hasta 2018)") 
glimpse(raw_vivienda_5)
unique(raw_vivienda_5$Totales)      # Borrar
unique(raw_vivienda_5$Tasa)         # Borrar
unique(raw_vivienda_5$Cantidad)     # Borrar
unique(raw_vivienda_5$Edad)         # "0 a 17 años"  "0 a 1 años"   "2 a 5 años"   "6 a 11 años"  "12 a 17 años"
unique(raw_vivienda_5$Sexo)         # Hombre Mujer y Total
unique(raw_vivienda_5$Entidad)      # Todos los estados y Nacional
unique(raw_vivienda_5$Año)          # 2008 2010 2012 2014 2016 2018

raw_vivienda_6 <- raw_vivienda_5 %>% select(Año, Entidad, Población, Sexo, Edad, Porcentaje)
```

Como se comparan estos dos?

```{r}
raw_vivienda_4 %>% filter(Año==2016 | Año==2018) %>% 
  filter(Edad=="0 a 17 años") %>% 
  group_by(Población) %>% 
  summarise(sum_p=sum(Porcentaje))
```

```{r}
raw_vivienda_6 %>% filter(Año==2016 | Año==2018) %>% 
  filter(Edad=="0 a 17 años") %>% 
  group_by(Población) %>% 
  summarise(sum_p=sum(Porcentaje))
```

# Propuestas Sara

## Matrimonio e Hijos

```{r}
unique(raw_data_2$Población)
```

```{r}
datos_1 <-raw_data_2 %>% 
  filter(
          Población == "Población afrodescendiente"  | 
          Población == "Población afrodescendiente que no asiste a la escuela"  | 
          Población == "Población afrodescendiente con hijos" |
          Población == "Población afrodescendiente sin afiliación a servicio de salud"  |
          Población == "Población afrodescendiente casada o en unión libre" |
          Población == "Población afrodescendiente con condición mental" |   
                        
          Población == "Población hablante de lengua indígena" |
          Población == "Población indígena que no asiste a la escuela" |
          Población == "Población indígena con hijos" |
          Población == "Población indígena sin afiliación a servicio de salud" |
          Población == "Población indígena casada o en unión libre" |
          Población == "Población indígena con condición mental" |
                      
          Población == "Población con condición mental" |
          Población == "Población con condición mental que no asiste a la escuela" |
          Población == "Población con condición mental con hijos" |
          Población == "Población con condición mental sin afiliación a servicio de salud" |
          Población == "Población con condición mental casada o en unión libre"
          ) %>% 
  select(Año, Entidad, Población, Sexo, Edad, Cantidad, Totales, Porcentaje)


datos_1 <- datos_1 %>% mutate(varios=paste(Población,Edad,Año)) %>% arrange(varios)

unique(datos_1$varios)

```

```{r}
raw_m_infantil <- raw_data_8 %>% filter(
                      Población == "Población casada o en unión libre" | 
                      Población == "Nacimientos de madres" | 
                      Población == "Población indígena casada o en unión libre" |
                      Población == "Población con condición mental casada o en unión libre" |
                      Población == "Población afrodescendiente casada o en unión libre" |
                      Población == "Población con hijos" |
                      Población == "Población indígena con hijos" |
                      Población == "Población con condición mental con hijos" |
                      Población == "Población afrodescendiente con hijos"#|
                      # Población == "Población afrodescendiente"  | 
                      # Población == "Población hablante de lengua indígena" |
                      # Población == "Población con condición mental" 
                      )

glimpse(raw_m_infantil)

unique(raw_m_infantil$Tasa)  # Se borra tasa
unique(raw_m_infantil$Edad)
unique(raw_m_infantil$Poblacion)
unique(raw_m_infantil$Año)

raw_m_infantil <- raw_m_infantil %>% select(Año, Entidad, Población, Sexo, Edad, Cantidad, Totales, Porcentaje)

raw_m_infantil %>% filter(Población=="Población casada o en unión libre")

```

```{r}
pob_casada <- raw_m_infantil %>% 
  filter(Población=="Población casada o en unión libre") %>% 
  filter(Sexo != "Total") %>% 
  filter(Edad=="12 a 17 años") %>% 
  filter(Entidad=="NACIONAL")

pob_casada

library(scales)

ggplot(pob_casada, aes(x = Año, y = Cantidad, fill = Sexo)) +
  geom_bar(stat = "identity") +
  ggtitle(str_wrap("Comparación entre Hombre y Mujeres Adolescentes (12-17 Años), casados o en unión libre a nivel nacional", width = 50)) +
  theme(plot.title = element_text(size = 14)) +
  scale_y_continuous(labels = comma)  # Use comma formatting for y-axis labels
```



```{r}
raw_m_infantil %>%
  filter(Población == "Población casada o en unión libre" |
         Población == "Población afrodescendiente casada o en unión libre" |
         Población == "Población indígena casada o en unión libre" |
         Población == "Población con condición mental casada o en unión libre"
  ) %>%
  mutate(Población = ifelse(Población == "Población casada o en unión libre", "Población en general", Población)) %>%
  mutate(Población = ifelse(Población == "Población afrodescendiente casada o en unión libre", "Afrodescendiente", Población)) %>%
  mutate(Población = ifelse(Población == "Población indígena casada o en unión libre", "Indígena", Población)) %>%
  mutate(Población = ifelse(Población == "Población con condición mental casada o en unión libre", "con condición mental", Población)) %>%
  mutate(Porcentaje=Porcentaje*100) %>% 
  filter(Sexo == "Total") %>%
  filter(Año == 2020) %>%
  filter(Entidad == "NACIONAL") %>%
  ggplot(aes(x = Población, y = Porcentaje, fill = Edad)) +
  geom_bar(stat = "identity") +
  ggtitle(str_wrap("Porcentaje de las adolescentes de poblaciones vulnerables que están casadas o en unión libre a nivel nacional (2020)", width = 50)) +
  theme(plot.title = element_text(size = 14)) +
  scale_y_continuous(labels = comma) 
```


```{r}
raw_m_infantil %>%
  filter(Población == "Población con hijos" |
         Población == "Población afrodescendiente con hijos" |
         Población == "Población indígena con hijos" |
         Población == "Población con condición mental con hijos"
  ) %>%
  mutate(Población = ifelse(Población == "Población con hijos", "Población en general", Población)) %>%
  mutate(Población = ifelse(Población == "Población afrodescendiente con hijos", "Afrodescendiente", Población)) %>%
  mutate(Población = ifelse(Población == "Población indígena con hijos", "Indígena", Población)) %>%
  mutate(Población = ifelse(Población == "Población con condición mental con hijos", "con condición mental", Población)) %>%
  mutate(Porcentaje=Porcentaje*100) %>% 
  filter(Sexo == "Mujer") %>% ###################################### OJO SOLO CUENTAN A LAS MUJERES
  filter(Año == 2020) %>%
  filter(Entidad == "NACIONAL") %>%
  ggplot(aes(x = Población, y = Porcentaje, fill = Edad)) +
  geom_bar(stat = "identity") +
  ggtitle(str_wrap("Porcentaje de mujeres adolescentes de poblaciones vulnerables que tienen hijos nivel nacional (2020)", width = 50)) +
  theme(plot.title = element_text(size = 14)) +
  scale_y_continuous(labels = comma) 
```
```{r}
raw_m_infantil %>%
  filter(Población == "Nacimientos de madres") %>% 
  ggplot(aes(x = Año, y = Cantidad, fill = Edad)) +
  geom_bar(stat = "identity") +
  ggtitle(str_wrap("Cantidad de Nacimientos de madres???, por año", width = 50)) +
  theme(plot.title = element_text(size = 14)) +
  scale_y_continuous(labels = comma)
```




## Escuela








